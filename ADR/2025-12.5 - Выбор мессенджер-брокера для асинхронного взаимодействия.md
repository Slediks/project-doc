**Дата:** 14 декабря 2025 г.

**Статус:** Принято

**Контекст:**

Микросервисная архитектура требует асинхронного взаимодействия:
- Уведомление аналитики о новых данных
- Пересчёт рекомендаций
- Генерация событий для уведомлений
- Надёжность и порядок сообщений

**Рассмотренные варианты:**

1. **RabbitMQ** – зрелый брокер с гарантиями доставки
2. **Apache Kafka** – распределённая потоковая обработка
3. **Redis (Streams)** – быстрый, но с меньшими гарантиями
4. **Управляемые облачные сервисы**

**Решение:**

Выбран **RabbitMQ** как основной брокер с опцией **Kafka** для событий аналитики.

**Обоснование:**

- **RabbitMQ для основного взаимодействия:** надёжность, гарантии доставки, интеграция с .NET
- **Topic Exchange для pub/sub:** подписка на интересующие события
- **Dead Letter Queue для обработки ошибок:** возможность повторной отправки
- **Kafka для масштабирования:** для высоконагруженных сценариев, архивирования

**Недостатки решения:**

- **Сложность операций:** требуется настройка кластеров, мониторинг
- **Гарантии доставки:** требуется идемпотентность обработчиков
- **Сетевая задержка:** асинхронность не мгновенна
- **Сложность отладки:** требуется централизованное логирование

**Последствия:**

- Обработчики сообщений в каждом микросервисе
- Стратегия обработки ошибок: повторы, экспоненциальная задержка
- Мониторинг RabbitMQ: размер очередей, пропускная способность
- Идемпотентность микросервисов
- Документация формата событий
- Возможная миграция на Kafka
